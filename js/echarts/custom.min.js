
function init_echarts(){
// start echarts
if("undefined"!=typeof echarts){console.log("init_echarts");var a={color:["#920076","#34495E","#BDC3C7","#3498DB","#9B59B6","#8abb6f","#759c6a","#bfd3b7"],title:{itemGap:8,textStyle:{fontWeight:"normal",color:"#408829"}},dataRange:{color:["#1f610a","#97b58d"]},toolbox:{color:["#408829","#408829","#408829","#408829"]},tooltip:{backgroundColor:"rgba(0,0,0,0.5)",axisPointer:{type:"line",lineStyle:{color:"#408829",type:"dashed"},crossStyle:{color:"#408829"},shadowStyle:{color:"rgba(200,200,200,0.3)"}}},dataZoom:{dataBackgroundColor:"#eee",fillerColor:"rgba(64,136,41,0.2)",handleColor:"#408829"},grid:{borderWidth:0},categoryAxis:{axisLine:{lineStyle:{color:"#408829"}},splitLine:{lineStyle:{color:["#eee"]}}},valueAxis:{axisLine:{lineStyle:{color:"#408829"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.1)","rgba(200,200,200,0.1)"]}},splitLine:{lineStyle:{color:["#eee"]}}},timeline:{lineStyle:{color:"#408829"},controlStyle:{normal:{color:"#408829"},emphasis:{color:"#408829"}}},k:{itemStyle:{normal:{color:"#68a54a",color0:"#a9cba2",lineStyle:{width:1,color:"#408829",color0:"#86b379"}}}},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#c12e34"}}},emphasis:{areaStyle:{color:"#99d2dd"},label:{textStyle:{color:"#c12e34"}}}}},force:{itemStyle:{normal:{linkStyle:{strokeColor:"#408829"}}}},chord:{padding:4,itemStyle:{normal:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"},chordStyle:{lineStyle:{width:1,color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{startAngle:225,endAngle:-45,axisLine:{show:!0,lineStyle:{color:[[.2,"#86b379"],[.8,"#68a54a"],[1,"#408829"]],width:8}},axisTick:{splitNumber:10,length:12,lineStyle:{color:"auto"}},axisLabel:{textStyle:{color:"auto"}},splitLine:{length:18,lineStyle:{color:"auto"}},pointer:{length:"90%",color:"auto"},title:{textStyle:{color:"#333"}},detail:{textStyle:{color:"auto"}}},textStyle:{fontFamily:"Arial, Verdana, sans-serif"}};

//if(map != undefined){
//map.remove();
//}

if($("#lfmap").length){
    document.getElementById('lfmap').innerHTML = "<div id='map' style='width: 100%; height: 100%;'></div>";
// initialize the map
  var map = L.map('map').setView([10, 20],2);
  // load a tile layer
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
    {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
      maxZoom: 17,
      minZoom: 1
    }).addTo(map);

setTimeout(function () { map.invalidateSize() }, 1200);

  // load GeoJSON from an external file
  $.getJSON("data/rladies_map_data.geojson",function(data){
    
 L.AwesomeMarkers.Icon.prototype.options.prefix = 'fa';
     var purpleMarker = L.AwesomeMarkers.icon({
icon: 'check-circle',
    markerColor: 'purple'
  });

var darkpurpleMarker = L.AwesomeMarkers.icon({
icon: 'user-times',
markerColor: 'darkpurple'
  });

var darkredMarker = L.AwesomeMarkers.icon({
icon: 'user-times',
    markerColor: 'orange'
  });


    // add GeoJSON layer to the map once the file is loaded
    L.geoJson(data,{
pointToLayer: function(feature,latlng){
density = feature.properties.past_events;
if ( density > 0 & feature.properties.days_since_last_event <= 180 ) {
      var marker = new L.marker(latlng, {icon: purpleMarker});

marker.bindPopup("<b>" + feature.properties.url + '</b>' + '<br/>' + 'Created: '+ feature.properties.created + '<br/>' +
 'Members: ' + feature.properties.members  + '<br/>' + 'Past Events: '+ feature.properties.past_events
  + '<br/>' + 'Upcoming Events: '+ feature.properties.upcoming_events + '<br/>' + 'Last Event Date: '+ feature.properties.last_event + '<br/>' + 'Active');
      return marker;
}
if ( density == 0 ) {
      var marker = new L.marker(latlng, {icon: darkredMarker});

marker.bindPopup("<b>" + feature.properties.url + '</b>' + '<br/>' + 'Created: '+ feature.properties.created + '<br/>' +
 'Members: ' + feature.properties.members  + '<br/>' + 'Past Events: '+ feature.properties.past_events
  + '<br/>' + 'Upcoming Events: '+ feature.properties.upcoming_events + '<br/>' + 'Unbegun: <a href="https://rladies.org/about-us/help/"><b>Become an Organizer!</b></a>');
      return marker;
}

if (feature.properties.days_since_last_event > 180 & density != 0 & feature.properties.upcoming_events == 0 ){
      var marker = new L.marker(latlng, {icon: darkpurpleMarker});
marker.bindPopup("<b>" + feature.properties.url + '</b>' + '<br/>' + 'Created: '+ feature.properties.created + '<br/>' +
 'Members: ' + feature.properties.members  + '<br/>' + 'Past Events: '+ feature.properties.past_events 
  + '<br/>' + 'Upcoming Events: '+ feature.properties.upcoming_events + '<br/>' + 'Last Event Date: '+ feature.properties.last_event + '<br/>'  + 'Inactive: <a href="https://rladies.org/about-us/help/"><b>Become an Organizer!</b></a>');
      return marker;
}

      
    }
  
}).addTo(map);


  });
 
  }



if($("#rladies_world_map").length){

d3.csv("data/rladies.csv").then(function(data) {
 var cleandata = data.map(function(d) {
    var cleanD = {};
    d3.keys(d).forEach(function(k) {
      cleanD[_.trim(k)] = _.trim(d[k]);
    });
    return cleanD;
  });
  //console.log(cleandata);

   
   var numberproj = d3.nest()
  .key(function(d) { return d.country  })
  .rollup(function(v) { return v.length;  })
  .entries(cleandata);
var dat2 = JSON.stringify(numberproj).replace(/key/g, 'name').replace(/USA/g, 'United States of America').replace(/Serbia/g, 'Republic of Serbia');
//console.log(dat2);
 



var n=echarts.init(document.getElementById("rladies_world_map"),a);n.setOption({tooltip:{trigger:"item",formatter:function(a){var b=(a.value+"").split(".");return b=b[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,"),a.seriesName+"<br/>"+a.name+" : "+b}},toolbox:{show:!0,orient:"vertical",x:"right",y:"center",feature:{mark:{show:!0},dataView:{show:!1,title:"Text View",lang:["Text View","Close","Refresh"],readOnly:!1},restore:{show:!1,title:"Restore"},saveAsImage:{show:!0,title:"Save Image"}}},dataRange:{show:!1,min:0,max:1,color:["#ff94e7","#FFFFFF"]},series:[{name:"R Ladies Groups ",type:"map",mapType:"world",roam:!0,scaleLimit:{min:1.28},mapLocation:{y:50},itemStyle:{emphasis:{label:{show:!0}}}, data:JSON.parse(dat2)
}]
})
}); // d3.csv call
}


//if($("#region_chart").length){

d3.json("data/rladies_summary.json").then(function(data) {
 regiondata = JSON.stringify(data[1]);
 chapters  = [data[1][0].us_can, data[1][0].eur, data[1][0].latinAm, data[1][0].aus, data[1][0].asia, data[1][0].afr];
 regions = ["US/Canada","Europe","Latin America","Australia","Asia","Africa"]


var f1=echarts.init(document.getElementById("region_chart"),a);f1.setOption({title:{text:"",subtext:""},color:["#9978ad"],tooltip:{trigger:"axis"},legend:{x:220,y:40,data:["Number of Chapters"]},toolbox:{show:!0,feature:{magicType:{show:!0,title:{line:"Line",bar:"Bar"},type:["line","bar"]},restore:{show:!0,title:"Restore"},saveAsImage:{show:!0,title:"Save Image"}}},calculable:!0,xAxis:[{type:"category",boundaryGap:!0,data:regions  }],yAxis:[{type:"value"}],series:[{name:"Number of Chapters",type:"bar",smooth:!1, barWidth:70,itemStyle:{}, data:chapters    }]})





if($("#member_pie").length){

   member_data = [{name: "Latin America", value: data[1][0].latinAm_m }, {name: "US/Canada", value: data[1][0].us_can_m }, {name: "Europe", value: data[1][0].eur_m }, {name: "Africa", value: data[1][0].afr_m }, {name: "Asia", value: data[1][0].asia_m }, {name: "Australia", value: data[1][0].aus_m } ];

var region  = [];
   
   for(let i = 0, l = member_data.length; i < l; i++) {
    region.push(member_data[i].name);
   }

var h=echarts.init(document.getElementById("member_pie"),a);h.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{x:"center",y:"bottom",data: region },toolbox:{show:!0,feature:{magicType:{show:!0,type:["pie","funnel"]},restore:{show:!0,title:"Restore"},saveAsImage:{show:!0,title:"Save Image"}}},calculable:!0,series:[{name:"Number of R-Ladies ",type:"pie",radius:[45,150],center:["50%",170],roseType:"area",x:"50%",max:40,sort:"ascending",data: member_data }]})
}

}); // d3.csv call for region_chart



if($("#cumulative_chart").length){

d3.json("data/rladies_cumulative.json").then(function(data) {
//console.log(data);
 dates = [];
 counts = []
   for(let i = 0, l = data.length; i < l; i++) {
      dates.push(data[i].datecreated)
     counts.push(data[i].Freq)
   }


var f2=echarts.init(document.getElementById("cumulative_chart"),a);f2.setOption({title:{text:"",subtext:""},color:["#920076"],tooltip:{trigger:"axis"},legend:{x:220,y:40,data:["Cumulative Count of Chapters"]},toolbox:{show:!0,feature:{magicType:{show:!0,title:{line:"Line",bar:"Bar"},type:["line","bar"]},restore:{show:!0,title:"Restore"},saveAsImage:{show:!0,title:"Save Image"}}},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data: dates}],yAxis:[{type:"value", splitArea:{show:!0,areaStyle:{color:["#fae4ff","#fcefff"]}}
 }],series:[{name:"Cumulative Count of Chapters",type:"line",smooth:!1,itemStyle:{normal:{areaStyle:{type:"default"}}},data:counts}]})

}); // d3.csv call for cumulative_chart


}

  }
}


!function(a,b){var c=function(a,b,c){var d;return function(){function h(){c||a.apply(f,g),d=null}var f=this,g=arguments;d?clearTimeout(d):c&&a.apply(f,g),d=setTimeout(h,b||100)}};jQuery.fn[b]=function(a){return a?this.bind("resize",c(a)):this.trigger(b)}}(jQuery,"smartresize");var CURRENT_URL=window.location.href.split("#")[0].split("?")[0],$BODY=$("body"),$MENU_TOGGLE=$("#menu_toggle"),$SIDEBAR_MENU=$("#sidebar-menu"),$SIDEBAR_FOOTER=$(".sidebar-footer"),$LEFT_COL=$(".left_col"),$RIGHT_COL=$(".right_col"),$NAV_MENU=$(".nav_menu"),$FOOTER=$("footer"),randNum=function(){return Math.floor(21*Math.random())+20};$(document).ready(function(){$(".collapse-link").on("click",function(){var a=$(this).closest(".x_panel"),b=$(this).find("i"),c=a.find(".x_content");a.attr("style")?c.slideToggle(200,function(){a.removeAttr("style")}):(c.slideToggle(200),a.css("height","auto")),b.toggleClass("fa-chevron-up fa-chevron-down")}),$(".close-link").click(function(){var a=$(this).closest(".x_panel");a.remove()})}),$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip({container:"body"})}),$(".progress .progress-bar")[0]&&$(".progress .progress-bar").progressbar(),$(document).ready(function(){if($(".js-switch")[0]){var a=Array.prototype.slice.call(document.querySelectorAll(".js-switch"));a.forEach(function(a){new Switchery(a,{color:"#26B99A"})})}}),$(document).ready(function(){$("input.flat")[0]&&$(document).ready(function(){$("input.flat").iCheck({checkboxClass:"icheckbox_flat-green",radioClass:"iradio_flat-green"})})}),$("table input").on("ifChecked",function(){checkState="",$(this).parent().parent().parent().addClass("selected"),countChecked()}),$("table input").on("ifUnchecked",function(){checkState="",$(this).parent().parent().parent().removeClass("selected"),countChecked()});var checkState="";$(".bulk_action input").on("ifChecked",function(){checkState="",$(this).parent().parent().parent().addClass("selected"),countChecked()}),$(".bulk_action input").on("ifUnchecked",function(){checkState="",$(this).parent().parent().parent().removeClass("selected"),countChecked()}),$(".bulk_action input#check-all").on("ifChecked",function(){checkState="all",countChecked()}),$(".bulk_action input#check-all").on("ifUnchecked",function(){checkState="none",countChecked()}),$(document).ready(function(){$(".expand").on("click",function(){$(this).next().slideToggle(200),$expand=$(this).find(">:first-child"),"+"==$expand.text()?$expand.text("-"):$expand.text("+")})}),"undefined"!=typeof NProgress&&($(document).ready(function(){NProgress.start()}),$(window).load(function(){NProgress.done()}));var originalLeave=$.fn.popover.Constructor.prototype.leave;$.fn.popover.Constructor.prototype.leave=function(a){var c,d,b=a instanceof this.constructor?a:$(a.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);originalLeave.call(this,a),a.currentTarget&&(c=$(a.currentTarget).siblings(".popover"),d=b.timeout,c.one("mouseenter",function(){clearTimeout(d),c.one("mouseleave",function(){$.fn.popover.Constructor.prototype.leave.call(b,b)})}))},$("body").popover({selector:"[data-popover]",trigger:"click hover",delay:{show:50,hide:400}}),$(document).ready(function(){init_echarts()});
